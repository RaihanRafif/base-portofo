<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />
    <title>Raihan Rafif</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="icon" type="image/x-icon" href="./assets/images/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
        }

        .hero-section {
            background-color: #1F2937;
            position: relative;
            overflow-x: hidden;
        }

        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-10px);
        }

        .tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 500;
            font-size: 0.75rem;
            transition: background-color 0.2s ease-in-out;
        }

        .modal-backdrop {
            transition: opacity 0.3s ease-in-out;
        }

        .modal-content {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }

        .typed-cursor {
            opacity: 1;
            animation: blink 0.7s infinite;
        }

        @keyframes blink {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        .glow-on-hover {
            transition: box-shadow 0.3s ease;
        }

        .glow-on-hover:hover {
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.5);
        }

        .pokemon-card-bg {
            background-color: #374151;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 224px;
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .pokemon-card-bg svg {
            width: 60%;
            height: 60%;
            object-fit: contain;
            z-index: 10;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.2));
        }

        .pokeball-bg {
            position: absolute;
            width: 80%;
            height: 80%;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='1' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Ccircle cx='12' cy='12' r='4'%3E%3C/circle%3E%3Cline x1='2' y1='12' x2='22' y2='12'%3E%3C/line%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
        }

        .flying-pokemon {
            position: absolute;
            top: 15%;
            right: 200px;
            width: 150px;
            height: auto;
            z-index: 0;
            opacity: 0.4;
            filter: brightness(0.9);
            animation: flyAcross 30s linear infinite;
        }

        /* Chat related styles... */
        #chat-icon {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #007bff;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            transition: transform 0.2s, background-color 0.2s;
            z-index: 9998;
            overflow: hidden;
        }

        #chat-icon:hover {
            transform: scale(1.1);
            background-color: #0056b3;
        }

        #chat-icon .chat-character {
            width: 50px;
            height: 50px;
            position: absolute;
            bottom: 0;
            animation: peek-animation 6s infinite ease-in-out;
            animation-delay: 1s;
        }

        #chat-icon:hover .chat-character {
            animation-play-state: paused;
        }

        #chat-icon #chat-close-icon {
            width: 32px;
            height: 32px;
        }

        #chat-window {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 90%;
            max-width: 400px;
            height: 60%;
            max-height: 500px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: none;
            flex-direction: column;
            background-color: #fff;
            z-index: 9999;
        }

        #chat-window.open {
            display: flex;
            animation: slide-up-animation 0.3s ease-out;
        }

        #chat-root {
            width: 100%;
            height: 100%;
        }

        /* Custom cursor for zoomable images */
        .zoomable-image {
            cursor: zoom-in;
        }

        .medium-zoom-image--opened {
            z-index: 1000;
        }

        @keyframes slide-up-animation {
            from {
                transform: translateY(20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes peek-animation {

            0%,
            100% {
                transform: translateY(100%);
            }

            10%,
            90% {
                transform: translateY(100%);
            }

            30%,
            70% {
                transform: translateY(15%);
            }

            50% {
                transform: translateY(15%);
            }
        }

        @keyframes flyAcross {
            from {
                transform: translateX(200px);
            }

            to {
                transform: translateX(-100vw);
            }
        }

        @media (max-width: 768px) {
            .flying-pokemon {
                display: none;
            }
        }
    </style>
</head>

<body class="text-gray-300">
    <header class="bg-gray-900/80 backdrop-blur-lg sticky top-0 z-50 border-b border-gray-700/80">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-white">Raihan Rafif</a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#projects" class="text-gray-300 hover:text-green-400">Projects</a>
                <a href="#skills" class="text-gray-300 hover:text-green-400">Skills</a>
                <a href="#contact"
                    class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-500 transition-colors glow-on-hover">Contact
                    Me</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden text-gray-300 focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7">
                    </path>
                </svg>
            </button>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden border-t border-gray-700">
            <a href="#projects" class="block py-2 px-4 text-sm text-gray-300 hover:bg-gray-800">Projects</a>
            <a href="#skills" class="block py-2 px-4 text-sm text-gray-300 hover:bg-gray-800">Skills</a>
            <a href="#contact" class="block py-2 px-4 text-sm text-green-400 font-semibold hover:bg-gray-800">Contact
                Me</a>
        </div>
    </header>

    <main>
        <section class="py-20 md:py-32 overflow-hidden hero-section">
            <img src="./assets/images/shadow-lugia.gif" class="flying-pokemon" alt="">
            <div class="container mx-auto px-6 text-center relative z-10">
                <div class="max-w-4xl mx-auto">
                    <span class="text-green-400 font-semibold" data-aos="fade-down">AI & FULL-STACK DEVELOPER</span>
                    <h1 class="text-4xl md:text-6xl font-black text-white mt-2 mb-6 leading-tight" data-aos="fade-up">
                        Crafting <span id="typed-text"></span></h1>
                    <p class="text-lg md:text-xl text-gray-400 mb-8 max-w-3xl mx-auto" data-aos="fade-up"
                        data-aos-delay="200">I build intelligent, full-stack solutions that solve real-world problems.
                        Specializing in integrating powerful AI capabilities into robust and user-friendly web
                        applications using React, Node.js, and Python.</p>
                    <div class="flex justify-center space-x-4" data-aos="fade-up" data-aos-delay="400">
                        <a href="#projects"
                            class="bg-green-600 text-white px-8 py-3 rounded-lg font-semibold text-lg hover:bg-green-500 transition-all transform hover:scale-105 glow-on-hover">Explore
                            My Projects</a>
                        <a href="#contact"
                            class="bg-gray-700 text-gray-200 px-8 py-3 rounded-lg font-semibold text-lg hover:bg-gray-600 transition-all">Let's
                            Team Up</a>
                    </div>
                </div>
            </div>
        </section>

        <section id="projects" class="py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12" data-aos="fade-up">
                    <h2 class="text-3xl md:text-4xl font-bold text-white">Featured Projects</h2>
                    <p class="text-lg text-gray-400 mt-2">A look into my Pokedex of completed works.</p>
                </div>
                <div id="projects-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
            </div>
        </section>

        <section id="skills" class="py-20 bg-gray-800">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12" data-aos="fade-up">
                    <h2 class="text-3xl md:text-4xl font-bold text-white">My Skill Set</h2>
                    <p class="text-lg text-gray-400 mt-2">The moves I've mastered on my journey.</p>
                </div>
                <div id="skills-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
                </div>
            </div>
        </section>

        <section id="contact" class="py-20">
            <div class="container mx-auto px-6">
                <div class="bg-gray-800 rounded-xl p-10 md:p-16 text-center max-w-4xl mx-auto border border-gray-700"
                    data-aos="zoom-in">
                    <h2 class="text-3xl md:text-4xl font-bold text-white">Ready for a new adventure?</h2>
                    <p class="text-lg md:text-xl mt-4 mb-8 text-gray-400">Let's discuss how I can help you achieve your
                        goals. I'm ready for the next challenge.</p>
                    <a href="mailto:raihanrafif1202@gmail.com"
                        class="bg-green-600 text-white px-8 py-3 rounded-lg font-semibold text-lg hover:bg-green-500 transition-all transform hover:scale-105 inline-block glow-on-hover">Start
                        a Conversation</a>
                </div>
            </div>
        </section>
    </main>

    <footer class="text-white py-8" style="background-color: #1F2937;">
        <div class="container mx-auto px-6 text-center">
            <p class="text-gray-400">&copy; <span id="year"></span> Raihan Rafif. All Rights Reserved.</p>
            <div class="flex justify-center space-x-6 mt-4">
                <a href="https://github.com/RaihanRafif" class="text-gray-400 hover:text-white">GitHub</a>
                <a href="https://www.linkedin.com/in/raihan-rafif-756809202/"
                    class="text-gray-400 hover:text-white">LinkedIn</a>
                <a href="#" class="text-gray-400 hover:text-white">Portfolio</a>
            </div>
        </div>
    </footer>

    <div id="project-modal"
        class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4 hidden modal-backdrop">
        <div
            class="bg-gray-800 text-gray-300 border border-gray-700 rounded-lg shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto modal-content transform scale-95 opacity-0">
            <div id="modal-content-container" class="p-8"></div>
        </div>
    </div>

    <div id="chat-icon">
        <div class="chat-character">
            <svg viewBox="0 0 100 80">
                <path fill="#FFC107"
                    d="M50,80 C77.61,80 100,62.09 100,40 C100,17.91 77.61,0 50,0 C22.39,0 0,17.91 0,40 C0,62.09 22.39,80 50,80 Z" />
                <circle fill="#333" cx="35" cy="35" r="6" />
                <circle fill="#333" cx="65" cy="35" r="6" />
                <path fill="#333" d="M50,55 C40,65 60,65 50,55 Z" />
            </svg>
        </div>
        <svg id="chat-close-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
            style="display: none;">
            <path
                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
        </svg>
    </div>
    <div id="chat-window">
        <div id="chat-root"></div>
    </div>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script>

    <script src="./assets/js/data.js"></script>
    <script>
        // --- 1. INITIAL PAGE SETUP ---
        document.addEventListener('DOMContentLoaded', () => {
            // Projects Grid Generation
            const projectsGrid = document.getElementById('projects-grid');
            if (typeof portfolioData !== 'undefined' && projectsGrid) {
                portfolioData.projects.forEach((project, index) => {
                    const aosDelay = (index % 3 + 1) * 100;
                    const card = `
                        <div class="bg-gray-800 rounded-xl border border-gray-700/80 overflow-hidden flex flex-col card-hover" data-aos="fade-up" data-aos-delay="${aosDelay}">
                            <div class="pokemon-card-bg ${project.theme.bg}">
                                <div class="pokeball-bg"></div>
                                ${project.icon.replace('{FILL_COLOR}', project.theme.fill)}
                            </div>
                            <div class="p-6 flex flex-col flex-grow">
                                <span class="text-sm font-semibold ${project.theme.text}">${project.category}</span>
                                <h3 class="text-xl font-bold text-white mt-2 mb-3">${project.title}</h3>
                                <p class="text-gray-400 mb-4 flex-grow">${project.summary}</p>
                                <button onclick="openModal('${project.id}')" class="mt-auto w-full text-center font-semibold ${project.theme.text} ${project.theme.hover} py-2 rounded-lg ${project.theme.buttonBg} ${project.theme.buttonHover} transition-colors">View Case Study &rarr;</button>
                            </div>
                        </div>`;
                    projectsGrid.innerHTML += card;
                });
            }

            // Skills Grid Generation
            const skillsGrid = document.getElementById('skills-grid');
            if (typeof portfolioData !== 'undefined' && skillsGrid) {
                portfolioData.skills.forEach((skillCategory, index) => {
                    const skillList = skillCategory.items.map(item => `<li class="flex items-start"><svg class="w-4 h-4 mr-2 mt-1 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg><span>${item}</span></li>`).join('');
                    const skillCard = `
                        <div class="bg-gray-900 p-8 rounded-lg border border-gray-700/60" data-aos="fade-up" data-aos-delay="${(index + 1) * 100}">
                            <h3 class="text-xl font-bold text-white mb-4">${skillCategory.title}</h3>
                            <ul class="space-y-3 text-gray-300">${skillList}</ul>
                        </div>`;
                    skillsGrid.innerHTML += skillCard;
                });
            }
        });

        // --- 2. GLOBAL INITIALIZATIONS & UTILITIES ---
        AOS.init({ duration: 800, once: false });
        new Typed('#typed-text', {
            strings: ['Intelligent Solutions.', 'Robust Backends.', 'Conversational AI.', 'Impactful Web Apps.'],
            typeSpeed: 50, backSpeed: 30, backDelay: 2000, loop: true, cursorChar: '|',
        });
        document.getElementById('year').textContent = new Date().getFullYear();

        // --- 3. MOBILE MENU ---
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

        // --- 4. PROJECT MODAL LOGIC ---
        const modal = document.getElementById('project-modal');
        const modalContentContainer = document.getElementById('modal-content-container');
        const modalContent = modal.querySelector('.modal-content');

        function openModal(projectId) {
            const project = portfolioData.projects.find(p => p.id === projectId);
            if (!project) return;

            const contributionsHTML = project.contributions.map(item => `<li>${item}</li>`).join('');
            const techHTML = project.tech.map(item => `<span class="tag bg-gray-700 text-gray-300">${item}</span>`).join('');

            let linksHTML = '';
            if (project.liveUrl) { linksHTML += `<a href="${project.liveUrl}" target="_blank" rel="noopener noreferrer" class="tag bg-green-600 text-white hover:bg-green-500">Live Demo</a>`; }
            if (project.repoUrl) { linksHTML += `<a href="${project.repoUrl}" target="_blank" rel="noopener noreferrer" class="tag bg-gray-600 text-gray-200 hover:bg-gray-500">GitHub Repo</a>`; }
            const linksSectionHTML = linksHTML ? `<h3 class="font-bold text-lg mt-6 mb-2 text-white">Project Links</h3><div class="flex flex-wrap gap-2">${linksHTML}</div>` : '';

            // --- LOGIKA PRATINJAU DINAMIS ---
            let previewHTML = '';
            const assets = project.assets;

            if (assets && (assets.video || assets.youtubeId || (assets.images && assets.images.length > 0))) {
                let videoPlayerHTML = '';
                let imageGalleryHTML = '';

                if (assets.youtubeId) {
                    const videoSrc = `https://www.youtube.com/embed/${assets.youtubeId}?autoplay=1&mute=1&loop=1&playlist=${assets.youtubeId}&controls=1&rel=0`;
                    videoPlayerHTML = `<div class="aspect-[16/9] w-full bg-black rounded-lg overflow-hidden border border-gray-700"><iframe class="w-full h-full" src="${videoSrc}" title="Project Demo" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe></div>`;
                } else if (assets.video) {
                    videoPlayerHTML = `<div class="aspect-[16/9] w-full bg-black rounded-lg overflow-hidden border border-gray-700"><video class="w-full h-full" controls autoplay muted loop playsinline><source src="${assets.video}" type="video/mp4">Your browser does not support the video tag.</video></div>`;
                }

                if (assets.images && assets.images.length > 0) {
                    if (videoPlayerHTML) { // Combined View: Video + Thumbnails
                        const thumbnails = assets.images.map(img => `<img src="${img}" alt="Project thumbnail" class="w-full h-full object-cover rounded-md aspect-square hover:scale-105 transition-transform duration-200 zoomable-image">`).join('');
                        imageGalleryHTML = `<div class="mt-4"><h4 class="text-base font-semibold text-gray-300 mb-2">Image Gallery</h4><div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2">${thumbnails}</div></div>`;
                    } else { // Images Only View: Carousel
                        const slides = assets.images.map(img => `<div class="carousel-slide min-w-full h-full flex items-center justify-center"><img src="${img}" class="max-w-full max-h-full object-contain zoomable-image"></div>`).join('');
                        imageGalleryHTML = `<div class="relative w-full max-h-96 h-96 aspect-video bg-gray-900/50 rounded-lg border border-gray-700 overflow-hidden"><div id="carousel-container" class="flex h-full transition-transform duration-500 ease-in-out">${slides}</div><button id="prev-btn" class="absolute top-1/2 left-2 transform -translate-y-1/2 bg-black/40 text-white p-2 rounded-full hover:bg-black/70">&lsaquo;</button><button id="next-btn" class="absolute top-1/2 right-2 transform -translate-y-1/2 bg-black/40 text-white p-2 rounded-full hover:bg-black/70">&rsaquo;</button></div>`;
                    }
                }
                previewHTML = `<div class="my-6">${videoPlayerHTML}${imageGalleryHTML}</div>`;
            } else { // Fallback if no assets
                previewHTML = `<div class="my-6 w-full h-48 bg-gray-700/50 rounded-lg border border-gray-700 flex items-center justify-center"><p class="text-gray-400">No preview available.</p></div>`;
            }

            const modalHTML = `<div class="flex justify-between items-start"><h2 class="text-2xl font-bold text-white">${project.title}</h2><button onclick="closeModal()" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button></div><span class="text-sm font-semibold ${project.theme.text}">${project.client}</span>${previewHTML}<h3 class="font-bold text-lg mb-2 text-white">Project Overview</h3><p class="text-gray-400 mb-6">${project.overview}</p><h3 class="font-bold text-lg mb-2 text-white">${project.contributions[0].startsWith('Fast') ? 'Key Features' : 'Key Contributions'}</h3><ul class="list-disc list-inside text-gray-400 space-y-2 mb-6">${contributionsHTML}</ul><h3 class="font-bold text-lg mb-2 text-white">Technology Stack</h3><div class="flex flex-wrap gap-2">${techHTML}</div>${linksSectionHTML}`;
            modalContentContainer.innerHTML = modalHTML;

            // --- INISIALISASI CAROUSEL (jika ada) ---
            const carouselContainer = document.getElementById('carousel-container');
            if (carouselContainer) {
                const prevBtn = document.getElementById('prev-btn');
                const nextBtn = document.getElementById('next-btn');
                const slides = carouselContainer.children;
                let currentIndex = 0;
                const updateCarousel = () => { carouselContainer.style.transform = `translateX(-${currentIndex * 100}%)`; };
                prevBtn.addEventListener('click', () => { currentIndex = (currentIndex > 0) ? currentIndex - 1 : slides.length - 1; updateCarousel(); });
                nextBtn.addEventListener('click', () => { currentIndex = (currentIndex < slides.length - 1) ? currentIndex + 1 : 0; updateCarousel(); });
            }

            // --- INISIALISASI ZOOM ---
            mediumZoom('.zoomable-image', { background: 'rgba(20, 20, 20, 0.9)' });

            // Show Modal
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function closeModal() {
            modal.classList.add('opacity-0');
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                modalContentContainer.innerHTML = ''; // Clear content to stop videos
            }, 300);
        }

        window.addEventListener('keydown', (event) => event.key === 'Escape' && closeModal());
        window.addEventListener('click', (event) => event.target === modal && closeModal());

        // --- 5. CHATBOT WIDGET LOGIC ---
        const chatIcon = document.getElementById('chat-icon');
        const chatWindow = document.getElementById('chat-window');
        const character = document.querySelector('.chat-character');
        const closeIcon = document.getElementById('chat-close-icon');

        chatIcon.addEventListener('click', () => {
            const isOpen = chatWindow.classList.toggle('open');
            if (character) { character.style.display = isOpen ? 'none' : 'block'; }
            closeIcon.style.display = isOpen ? 'block' : 'none';
        });
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const UserIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="w-8 h-8 text-white bg-blue-500 rounded-full p-1.5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" /></svg>);
        const BotIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="w-8 h-8 text-white bg-green-500 rounded-full p-1.5" viewBox="0 0 24 24" fill="currentColor"><path d="M15 8V4H9v4H5v12h14V8h-4zM9 6h6v2H9V6zm10 14H5v-3h14v3zm-1-6H6v-2h12v2z" /></svg>);
        const SendIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" /></svg>);

        const FormattedMessage = ({ text }) => {
            const formatText = (txt) => {
                let formatted = txt.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                formatted = formatted.replace(/^\* (.*$)/gm, '<ul><li class="ml-4 list-disc">$1</li></ul>');
                formatted = formatted.replace(/<\/ul>\n<ul>/g, '');
                return { __html: formatted };
            };
            return <p className="whitespace-pre-wrap break-words" dangerouslySetInnerHTML={formatText(text)} />;
        };

        const App = () => {
            const [messages, setMessages] = useState([]);
            const [inputValue, setInputValue] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const chatEndRef = useRef(null);
            // const BACKEND_URL = 'http://localhost:3001/api/chat';
            const BACKEND_URL = 'https://www.hajirehan.store/api/chat';

            useEffect(() => { chatEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages]);

            useEffect(() => {
                setMessages([{ text: `Hello! mosi mosi konnichiwa いらっしゃいませ, I am Raihan Rafif's Personal Assistant. What can I help you with? 😗`, isUser: false }]);
            }, []);

            const handleSendMessage = async (e) => {
                e.preventDefault();
                const trimmedInput = inputValue.trim();
                if (!trimmedInput || isLoading) return;

                const userMessage = { text: trimmedInput, isUser: true };
                setMessages(prev => [...prev, userMessage]);
                setInputValue('');
                setIsLoading(true);

                try {
                    const response = await fetch(BACKEND_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ query: trimmedInput }),
                    });

                    if (!response.ok) { throw new Error(`Backend request failed with status: ${response.status}`); }

                    const data = await response.json();
                    const botMessage = { text: data.response, isUser: false };
                    setMessages(prev => [...prev, botMessage]);

                } catch (error) {
                    console.error("Error fetching bot response:", error);
                    const errorMessage = { text: "Sorry, I'm having trouble connecting to the server. Please ensure the backend is running and try again.", isUser: false };
                    setMessages(prev => [...prev, errorMessage]);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="flex flex-col h-full bg-gray-100 font-sans">
                    <header className="bg-white shadow-md p-4 flex-shrink-0"><h1 className="text-xl font-bold text-gray-800 text-center">Raihan's Assistant</h1></header>
                    <main className="flex-1 p-4 overflow-y-auto">
                        <div className="space-y-4">
                            {messages.map((msg, index) => (
                                <div key={index} className={`flex items-start gap-3 ${msg.isUser ? 'justify-end' : 'justify-start'}`}>
                                    {!msg.isUser && <BotIcon />}
                                    <div className={`max-w-xs md:max-w-md p-3 rounded-2xl ${msg.isUser ? 'bg-blue-600 text-white rounded-br-none shadow-md' : 'bg-white text-gray-700 rounded-bl-none shadow-md'}`}><FormattedMessage text={msg.text} /></div>
                                    {msg.isUser && <UserIcon />}
                                </div>
                            ))}
                            {isLoading && (
                                <div className="flex items-start gap-3 justify-start">
                                    <BotIcon />
                                    <div className="max-w-lg p-3 rounded-2xl bg-white text-gray-800 rounded-bl-none shadow-sm">
                                        <div className="flex items-center space-x-2"><div className="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:-0.3s]"></div><div className="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:-0.15s]"></div><div className="w-2 h-2 bg-gray-400 rounded-full animate-pulse"></div></div>
                                    </div>
                                </div>
                            )}
                            <div ref={chatEndRef} />
                        </div>
                    </main>
                    <footer className="bg-white border-t border-gray-200 p-2 md:p-4 flex-shrink-0">
                        <form onSubmit={handleSendMessage} className="flex items-center gap-2">
                            <input type="text" value={inputValue} onChange={(e) => setInputValue(e.target.value)} placeholder="Ask a question..." className="flex-1 p-3 text-black border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition" disabled={isLoading} />
                            <button type="submit" className="p-3 bg-blue-500 text-white rounded-full hover:bg-blue-600 disabled:bg-blue-300 disabled:cursor-not-allowed transition" disabled={isLoading || !inputValue.trim()}><SendIcon /></button>
                        </form>
                    </footer>
                </div>
            );
        };
        const container = document.getElementById('chat-root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>

</html>